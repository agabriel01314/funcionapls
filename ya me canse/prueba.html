<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rompecabezas Interactivo</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #F8C8DC, #F5EBDD, #DCCFFB);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        canvas {
            border: 2px solid black;
            width: 250px;
            height: 250px;
            background-color: white;
        }
        .menu button {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #F5EBDD;
        }
    </style>
</head>
<body>
    <h1>Rompecabezas Interactivo</h1>
    <div class="menu">
        <button onclick="selectDifficulty()">Dificultad: <span id="difficultyText">Fácil</span></button>
        <button onclick="selectImage()">Imagen: <span id="imageText">1</span></button>
        <button onclick="startPuzzle()">Iniciar Juego</button>
    </div>
    <canvas id="puzzleCanvas" width="250" height="250"></canvas>
    <script>
        let imagePaths = ["img1flor.jpg", "img2flor.jpg", "img3flor.jpg", "img4flor.jpg"];
        let selectedImageIndex = 0;
        let difficulties = {"Fácil": 3, "Medio": 4, "Difícil": 5};
        let selectedDifficulty = "Fácil";
        const canvas = document.getElementById("puzzleCanvas");
        const ctx = canvas.getContext("2d");
        let pieces = [];
        let selectedPiece = null;
        let offsetX, offsetY;

        function selectDifficulty() {
            let keys = Object.keys(difficulties);
            let index = keys.indexOf(selectedDifficulty);
            index = (index + 1) % keys.length;
            selectedDifficulty = keys[index];
            document.getElementById("difficultyText").innerText = selectedDifficulty;
        }

        function selectImage() {
            selectedImageIndex = (selectedImageIndex + 1) % imagePaths.length;
            document.getElementById("imageText").innerText = selectedImageIndex + 1;
        }

        function startPuzzle() {
            pieces = [];
            let img = new Image();
            img.src = imagePaths[selectedImageIndex];
            img.onload = function () {
                let rows = difficulties[selectedDifficulty];
                let cols = difficulties[selectedDifficulty];
                let pieceWidth = canvas.width / cols;
                let pieceHeight = canvas.height / rows;
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        let piece = {
                            imgX: j * (img.width / cols),
                            imgY: i * (img.height / rows),
                            x: Math.random() * (canvas.width - pieceWidth),
                            y: Math.random() * (canvas.height - pieceHeight),
                            width: pieceWidth,
                            height: pieceHeight
                        };
                        pieces.push(piece);
                    }
                }
                drawPuzzle(img);
            };
        }

        function drawPuzzle(img) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            pieces.forEach(piece => {
                ctx.drawImage(img, piece.imgX, piece.imgY, img.width / difficulties[selectedDifficulty], img.height / difficulties[selectedDifficulty], piece.x, piece.y, piece.width, piece.height);
            });
        }

        canvas.addEventListener("mousedown", function (e) {
            const mouseX = e.offsetX;
            const mouseY = e.offsetY;
            pieces.forEach(piece => {
                if (mouseX > piece.x && mouseX < piece.x + piece.width && mouseY > piece.y && mouseY < piece.y + piece.height) {
                    selectedPiece = piece;
                    offsetX = mouseX - piece.x;
                    offsetY = mouseY - piece.y;
                }
            });
        });

        canvas.addEventListener("mousemove", function (e) {
            if (selectedPiece) {
                selectedPiece.x = e.offsetX - offsetX;
                selectedPiece.y = e.offsetY - offsetY;
                let img = new Image();
                img.src = imagePaths[selectedImageIndex];
                img.onload = function () {
                    drawPuzzle(img);
                };
            }
        });

        canvas.addEventListener("mouseup", function () {
            selectedPiece = null;
        });
    </script>
</body>
</html>
